<!DOCTYPE html>
{% load dajaxice_templatetags %}
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->

<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->

<!--[if !IE]><!-->
<html lang="zh-cn" class="no-js"> <!--<![endif]-->

<!-- BEGIN HEAD -->

<head>

    <meta charset="utf-8"/>

    <title>Metronic | Admin Dashboard Template</title>

    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>

    <meta content="" name="description"/>

    <meta content="" name="author"/>

    <!-- BEGIN GLOBAL MANDATORY STYLES -->

    <link href="/media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/style-metro.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/style.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/style-responsive.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>

    <link href="/media/css/uniform.default.css" rel="stylesheet" type="text/css"/>

    <link rel="stylesheet" type="text/css" href="/media/css/select2_metro.css"/>

    <link rel="stylesheet" href="/media/css/DT_bootstrap.css"/>

    <!-- END GLOBAL MANDATORY STYLES -->

    <!-- BEGIN PAGE LEVEL STYLES -->

    <link href="/media/css/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>

    <link href="/media/css/bootstrap-modal.css" rel="stylesheet" type="text/css"/>

    <link rel="stylesheet" type="text/css" href="/media/css/multi-select-metro.css" />

    <!-- END PAGE LEVEL STYLES -->

    <link rel="shortcut icon" href="/media/image/favicon.ico"/>

    {% dajaxice_js_import %}
</head>

<!-- END HEAD -->

<style>
    body {
        font-family: "微软雅黑";
    }
</style>

<!-- BEGIN BODY -->

<body class="page-header-fixed">

<!-- BEGIN HEADER -->

<div class="header navbar navbar-inverse navbar-fixed-top">

    <!-- BEGIN TOP NAVIGATION BAR -->

    <div class="navbar-inner">

        <div class="container-fluid">

            <!-- BEGIN LOGO -->

            <a class="brand" href="index.html">

                <img src="/media/image/logo.png" alt="logo"/>

            </a>

            <!-- END LOGO -->

            <!-- BEGIN RESPONSIVE MENU TOGGLER -->

            <a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">

                <img src="/media/image/menu-toggler.png" alt=""/>

            </a>

            <!-- END RESPONSIVE MENU TOGGLER -->

        </div>

    </div>

    <!-- END TOP NAVIGATION BAR -->

</div>

<!-- END HEADER -->

<!-- BEGIN CONTAINER -->

<div class="page-container">

    <!-- BEGIN SIDEBAR -->

    <div class="page-sidebar nav-collapse collapse">

        <!-- BEGIN SIDEBAR MENU -->

        <ul class="page-sidebar-menu">

            <li>

                <!-- BEGIN SIDEBAR TOGGLER BUTTON -->

                <div class="sidebar-toggler hidden-phone"></div>

                <!-- BEGIN SIDEBAR TOGGLER BUTTON -->

            </li>

            <br>

            <li class="start ">

                <a href="/index/">

                    <i class="icon-home"></i>

                    <span class="title">首页</span>

                    <span class="selected"></span>

                </a>

            </li>

            <li class="">

                <a href="/charts/">

                    <i class="icon-bar-chart"></i>

                    <span class="title">图表</span>

                </a>

            </li>

            <li class="active">

                <a href="/tables/">

                    <i class="icon-table"></i>

                    <span class="title">表格</span>

                </a>

            </li>

            <li class="">

                <a href="/ranking_list/">

                    <i class="icon-bookmark-empty"></i>

                    <span class="title">排行榜</span>

                </a>

            </li>

            <li class="">

                <a href="/manage/">

                    <i class="icon-cogs"></i>

                    <span class="title">管理</span>

                </a>

            </li>

            <li class="last ">

                <a href="charts.html">

                    <i class="icon-file-text"></i>

                    <span class="title">关于</span>

                </a>

            </li>

        </ul>

        <!-- END SIDEBAR MENU -->

    </div>

    <!-- END SIDEBAR -->

    <!-- BEGIN PAGE -->

    <div class="page-content">

        <!-- BEGIN PAGE CONTAINER-->

        <div class="container-fluid">

            <!-- BEGIN PAGE HEADER-->

            <div class="row-fluid">

                <div class="span12">

                    <!-- BEGIN PAGE TITLE & BREADCRUMB-->

                    <h3 class="page-title">

                        表格

                    </h3>

                    <ul class="breadcrumb">

                        <li>

                            <i class="icon-home"></i>

                            <a href="index.html">表格</a>

                            <i class="icon-angle-right"></i>

                        </li>

                        <li><a href="#">查看视频</a></li>

                    </ul>

                    <!-- END PAGE TITLE & BREADCRUMB-->

                </div>

            </div>

            <!-- END PAGE HEADER-->

            <div id="dashboard">

                <div class="clearfix"></div>

                <div class="row-fluid">

                    <div class="span12">
                        <!-- BEGIN PORTLET-->

                        <div class="portlet box blue">

                            <div class="portlet-title">

                                <div class="caption"><i class="icon-globe"></i>视频列表</div>

                                <div class="tools">

                                    <a href="javascript:;" class="collapse"></a>

                                    <a href="javascript:;" class="reload"></a>

                                    <a href="javascript:;" class="remove"></a>

                                </div>

                            </div>

                            <div class="portlet-body">

                                <div class="clearfix">

{#                                    <div class="btn-group pull-right">#}
{##}
{#                                        <button class="btn dropdown-toggle" data-toggle="dropdown">Tools <i#}
{#                                                class="icon-angle-down"></i>#}
{##}
{#                                        </button>#}
{##}
{#                                        <ul class="dropdown-menu pull-right">#}
{#                                            <li><a href="#">导出到Excel</a></li>#}
{#                                        </ul>#}
{##}
{#                                    </div>#}

                                    <div class="btn-group pull-right">

										<button class="btn dropdown-toggle" data-toggle="dropdown">Excel <i class="icon-angle-down"></i>

										</button>

										<ul class="dropdown-menu pull-right">

											<li><a id="export_now_page" href="" onclick="return download_excel();">导出本页到Excel</a></li>

											<li><a href="/download_excel/all.xls">导出所有到Excel</a></li>

										</ul>

									</div>

                                </div>

                                <div class="row-fluid">
                                    <div class="span6">
                                        <div id="sample_2_length" class="dataTables_length">
                                            <label>
                                                <select id="site_id" class="medium m-wrap" tabindex="0"
                                                        onchange="filter_select(this);">
                                                    <option value="-1">按视频来源筛选</option>
                                                    {% for site in sites %}
                                                        <option value="{{ site.id }}">{{ site.ch_name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="span6">
                                        <div class="dataTables_filter" id="sample_2_filter">
                                            <label>
                                                <input type="text" aria-controls="sample_2" class="m-wrap small" id="key_word">
                                                <button class="btn" onclick="Dajaxice.spider.get_table_with_page_site_search(generateTable, {'page': 1, 'site': parseInt($('#site_id').val()), 'search': $('#key_word').val(), 'type': ''});">查找</button>
{#                                                <button class="btn" onclick="Dajaxice.spider.get_table_with_page_site_search(generateTable, {'page': 1, 'site': parseInt($('#site_id').val()), 'search': $('#key_word').val(), 'type': ''});">导出到Excel</button>#}
{#                                                <a class="btn blue" data-toggle="modal" href="#responsive">导出到Excel</a>#}
{#                                                <div id="responsive" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">#}
{#                                                  <div class="modal-header">#}
{#                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>#}
{#                                                    <h3 id="myModalLabel">Excel选项</h3>#}
{#                                                  </div>#}
{#                                                    <form method="get" action="/download_excel/" class="form-horizontal">#}
{#                                                        <p>One fine body…</p>#}
{#                                                        <div class="control-group">#}
{#                                                            <label class="control-label">视频来源</label>#}
{#                                                            <div class="controls">#}
{#                                                                <select multiple="multiple" id="my_multi_select1" name="my_multi_select1[]">#}
{#                                                                    {% for site in sites %}#}
{#                                                                      <option value="{{ site.id }}">{{ site.ch_name }}</option>#}
{#                                                                    {% endfor %}#}
{#                                                                </select>#}
{#                                                            </div>#}
{#                                                        </div>#}
{#                                                      <div class="modal-footer">#}
{#                                                        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>#}
{#                                                        <button class="btn btn-primary">确认导出</button>#}
{#                                                      </div>#}
{#                                                    </form>#}
{#                                                </div>#}
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <table class="table table-striped table-bordered table-hover" id="sample_2">

                                    <thead>
                                        <tr>
                                            {% for col in cols %}
                                                <th>{{ col }}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody id="table_body">

                                    </tbody>
                                    <input class="hidden" id="now_page" value="">

                                </table>

                                <div class="row-fluid">
                                    <div class="span6 offset6">
                                        <div class="dataTables_paginate paging_bootstrap pagination">
                                            <ul id="page_selector">

                                            </ul>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <a name="scrollTo" id="scrollTo"></a>
                        <!-- END PORTLET-->
                    </div>
                </div>

{#                {% include 'charts_in.html' %}#}
            </div>

        </div>

        <!-- END PAGE CONTAINER-->

    </div>

    <!-- END PAGE -->

</div>

<!-- END CONTAINER -->

<!-- BEGIN FOOTER -->

<div class="footer">

    <div class="footer-inner">

        2013 &copy; Metronic by keenthemes.Collect

    </div>

    <div class="footer-tools">

			<span class="go-top">

			<i class="icon-angle-up"></i>

			</span>

    </div>

</div>

<!-- END FOOTER -->

<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->

<!-- BEGIN CORE PLUGINS -->

<script src="/media/js/jquery-1.10.1.min.js" type="text/javascript"></script>

<script src="/media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>

<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->

<script src="/media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>

<script src="/media/js/bootstrap.min.js" type="text/javascript"></script>

<!--[if lt IE 9]>

	<script src="media/js/excanvas.min.js"></script>

	<script src="media/js/respond.min.js"></script>

	<![endif]-->

<script src="/media/js/jquery.slimscroll.min.js" type="text/javascript"></script>

<script src="/media/js/jquery.blockui.min.js" type="text/javascript"></script>

<script src="/media/js/jquery.cookie.min.js" type="text/javascript"></script>

<script src="/media/js/jquery.uniform.min.js" type="text/javascript"></script>

<script type="text/javascript" src="/media/js/jquery.dataTables.js"></script>

<script type="text/javascript" src="/media/js/select2.min.js"></script>

<script type="text/javascript" src="/media/js/DT_bootstrap.js"></script>

<script src="/media/js/bootstrap-modal.js" type="text/javascript" ></script>

<script src="/media/js/bootstrap-modalmanager.js" type="text/javascript" ></script>
<script type="text/javascript" src="/media/js/jquery.multi-select.js"></script>

<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE LEVEL SCRIPTS -->

<script src="/media/js/app.js" type="text/javascript"></script>

<script src="/media/js/highcharts.js"></script>

<script src="/media/js/modules/exporting.js"></script>

<script src="/media/js/table-managed.js"></script>

<script src="/media/js/ui-modals.js"></script>

<script src="/media/js/form-components.js"></script>

<!-- END PAGE LEVEL SCRIPTS -->

<script>

    jQuery(document).ready(function () {

        App.init(); // initlayout and core plugins

        UIModals.init();

        FormComponents.init();

        $('#export_now_page').attr('href', "/download_excel/out.xls?site="+parseInt($('#site_id').val())+"&search="+$('#key_word').val()+"&page="+$('#now_page').val());

        {#           TableManaged.init();#}
        get_table_by_page(1, -1, '');


    });

</script>

<script>
    function filter_select(obj) {
{#        console.log(parseInt($('#site_id').val()));#}
        var site = parseInt($('#site_id').val());
        Dajaxice.spider.get_table_with_page_site_search(generateTable, {'page': 1, 'site': site, 'search': $('#key_word').val(), 'type': ''});
        return false;
    }

    function addLi(s, html, classList){
        var t = s.childNodes.length;
        var li = document.createElement("li");
        console.log(classList);
        for(var i = 0;i < classList.length;i ++) {
            li.classList.add(classList[i]);
        }
        li.innerHTML = html;
        s.appendChild(li);
    }

    function clearPageSelector(){
        var s = document.getElementById("page_selector");
        var t = s.childNodes.length;

        for(var i = t-1;i >= 0;i --) {
            s.removeChild(s.childNodes[i]);
        }
    }

    function generatePageSelector(page_num, page_total) {
        clearPageSelector();
        var s = document.getElementById("page_selector");
        var t = s.childNodes.length;

        prev_class_list = ["prev"];
        next_class_list = ['next'];
        if(page_num == "1"){
            prev_class_list.push("disabled");
            addLi(s, "<a href=\"#\" onclick=\"return false;\"><span class=\"hidden-480\">|<<</span></a>", prev_class_list);
            addLi(s, "<a href=\"#\" onclick=\"return false;\"><span class=\"hidden-480\"><<</span></a>", prev_class_list);
        }else{
            addLi(s, "<a href=\"#\" onclick=\"return get_table_by_page(1, parseInt($('#site_id').val()), $('#key_word').val());\"><span class=\"hidden-480\">|<<</span></a>", prev_class_list);
            addLi(s, "<a href=\"#\" onclick=\"return get_table_by_page(parseInt($('#now_page').val())-1, parseInt($('#site_id').val()), $('#key_word').val());\"><span class=\"hidden-480\"><<</span></a>", prev_class_list);
        }
        addLi(s, "<a href=\"#\" onclick=\"return false;\">"+page_num+"/"+page_total+"</a>", ['active']);
        if (page_num == page_total){
            next_class_list.push("disabled");
            addLi(s, "<a href=\"#\" onclick=\"return false;\"><span class=\"hidden-480\">>></span></a>", next_class_list);
            addLi(s, "<a href=\"#\" onclick=\"return false;\"><span class=\"hidden-480\">>>|</span></a>", next_class_list);
        }else{
            addLi(s, "<a href=\"#\" onclick=\"return get_table_by_page(parseInt($('#now_page').val())+1, parseInt($('#site_id').val()), $('#key_word').val());\"><span class=\"hidden-480\">>></span></a>", next_class_list);
            addLi(s, "<a href=\"#\" onclick=\"return get_table_by_page("+page_total+", parseInt($('#site_id').val()), $('#key_word').val());\"><span class=\"hidden-480\">>>|</span></a>", next_class_list);
        }

    }

    function clearTable() {
        var tb = document.getElementById("sample_2");
        var row_count = tb.rows.length;

        for (var i = row_count - 1; i > 0; i--) {
            tb.deleteRow(i);
        }
    }

    function get_table_by_page(page_num, site, key_word) {
        console.log(page_num, site, key_word);
        $('#now_page').val(page_num);
        Dajaxice.spider.get_table_with_page_site_search(generateTable, {'page': page_num, 'site': site, 'search': key_word, 'type': ''});
        return false;
    }

    function generateTable(data) {
        console.log(data);
        clearTable();
        var tb = document.getElementById("sample_2");

        for (var i = 0; i < data.result.length; i++) {
            var row = tb.insertRow(tb.rows.length);

            var video_id = row.insertCell(row.cells.length);
            var video_title = row.insertCell(row.cells.length);
            var video_from = row.insertCell(row.cells.length);
            var video_date = row.insertCell(row.cells.length);
            var video_play = row.insertCell(row.cells.length);
            var video_favorite = row.insertCell(row.cells.length);
            var video_community = row.insertCell(row.cells.length);
            var video_upcount = row.insertCell(row.cells.length);
            var video_downcount = row.insertCell(row.cells.length);

            video_id.innerHTML = data.result[i][0];
            video_title.innerHTML = "<a class=\"popovers\" data-trigger=\"hover\" data-placement=\"top\" data-content=\"<img src=\'" + data.result[i][10] + "\'>\" data-html=\"true\" data-original-title=\"预览\" target=\"_blank\" href=\"" + data.result[i][9] + "\">" + data.result[i][1] + "</a>";
            video_date.innerHTML = data.result[i][2];
            video_play.innerHTML = data.result[i][3];
            video_favorite.innerHTML = data.result[i][4];
            video_from.innerHTML = data.result[i][5];
            video_community.innerHTML = data.result[i][6];
            video_upcount.innerHTML = data.result[i][7];
            video_downcount.innerHTML = data.result[i][8];

        }

        console.log($('#now_page').val());
        generatePageSelector(data.page_now, data.page_total);
        App.init();

    }

    function download_excel() {
        $('#export_now_page').attr('href', "/download_excel/out.xls?site="+parseInt($('#site_id').val())+"&search="+$('#key_word').val()+"&page="+$('#now_page').val());
    }
</script>
<!-- END JAVASCRIPTS -->

</body>

<!-- END BODY -->

</html>