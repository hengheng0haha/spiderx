<!DOCTYPE html>
{% load dajaxice_templatetags %}
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->

<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->

<!--[if !IE]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->

<!-- BEGIN HEAD -->

<head>

    <meta charset="utf-8"/>

    <title>Metronic | Admin Dashboard Template</title>

    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>

    <meta content="" name="description"/>

    <meta content="" name="author"/>

    <!-- BEGIN GLOBAL MANDATORY STYLES -->

    <link href="/media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/style-metro.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/style.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/style-responsive.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>

    <link href="/media/css/uniform.default.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/coming-soon.css" rel="stylesheet" type="text/css"/>

    <link href="/media/css/jquery.gritter.css" rel="stylesheet" type="text/css"/>

    <!-- END GLOBAL MANDATORY STYLES -->

    <!-- BEGIN PAGE LEVEL STYLES -->

    <link href="/media/css/jquery.easy-pie-chart.css" rel="stylesheet" type="text/css" media="screen"/>

    <!-- END PAGE LEVEL STYLES -->

    <link rel="shortcut icon" href="/media/image/favicon.ico"/>

    {% dajaxice_js_import %}

</head>

<!-- END HEAD -->

<style>
    body {
        font-family: "微软雅黑";
    }
</style>

<!-- BEGIN BODY -->

<body class="page-header-fixed">

<!-- BEGIN HEADER -->

<div class="header navbar navbar-inverse navbar-fixed-top">

    <!-- BEGIN TOP NAVIGATION BAR -->

    <div class="navbar-inner">

        <div class="container-fluid">

            <!-- BEGIN LOGO -->

            <a class="brand" href="index.html">

                <img src="/media/image/logo.png" alt="logo"/>

            </a>

            <!-- END LOGO -->

            <!-- BEGIN RESPONSIVE MENU TOGGLER -->

            <a href="javascript:;" class="btn-navbar collapsed" data-toggle="collapse" data-target=".nav-collapse">

                <img src="/media/image/menu-toggler.png" alt=""/>

            </a>

            <!-- END RESPONSIVE MENU TOGGLER -->

        </div>

    </div>

    <!-- END TOP NAVIGATION BAR -->

</div>

<!-- END HEADER -->

<!-- BEGIN CONTAINER -->

<div class="page-container">

    <!-- BEGIN SIDEBAR -->

    <div class="page-sidebar nav-collapse collapse">

        <!-- BEGIN SIDEBAR MENU -->

        <ul class="page-sidebar-menu">

            <li>

                <!-- BEGIN SIDEBAR TOGGLER BUTTON -->

                <div class="sidebar-toggler hidden-phone"></div>

                <!-- BEGIN SIDEBAR TOGGLER BUTTON -->

            </li>

            <br>

            <li class="start ">

                <a href="/index">

                    <i class="icon-home"></i>

                    <span class="title">首页</span>

                    <span class="selected"></span>

                </a>

            </li>

            <li class="">

                <a href="/charts/">

                    <i class="icon-bar-chart"></i>

                    <span class="title">图表</span>

                </a>

            </li>

            <li class="">

                <a href="/tables/">

                    <i class="icon-table"></i>

                    <span class="title">表格</span>

                </a>

            </li>

            <li class="">

                <a href="/ranking_list/">

                    <i class="icon-bookmark-empty"></i>

                    <span class="title">排行榜</span>

                </a>

            </li>

            <li class="active">

                <a href="/manage/">

                    <i class="icon-cogs"></i>

                    <span class="title">管理</span>

                </a>

            </li>

            <li class="last ">

                <a href="charts.html">

                    <i class="icon-file-text"></i>

                    <span class="title">关于</span>

                </a>

            </li>

        </ul>

        <!-- END SIDEBAR MENU -->

    </div>

    <!-- END SIDEBAR -->

    <!-- BEGIN PAGE -->

    <div class="page-content">

        <!-- BEGIN PAGE CONTAINER-->

        <div class="container-fluid">

            <!-- BEGIN PAGE HEADER-->

            <div class="row-fluid">

                <div class="span12">

                    <!-- BEGIN PAGE TITLE & BREADCRUMB-->

                    <h3 class="page-title">

                        后台管理

                    </h3>

                    <ul class="breadcrumb">

                        <li>

                            <i class="icon-home"></i>

                            <a href="index.html">管理</a>

                            <i class="icon-angle-right"></i>

                        </li>

                        <li><a href="#">后台管理</a></li>

                    </ul>

                    <!-- END PAGE TITLE & BREADCRUMB-->

                </div>

            </div>

            <!-- END PAGE HEADER-->

            <div id="dashboard">

                <div class="clearfix"></div>

                <div class="row-fluid">


                    <!-- BEGIN PORTLET-->
                    {% if identity %}
                        <div class="portlet box blue">

                            <div class="portlet-title">

                                <div class="caption"><i class="icon-reorder"></i>后台进程状态</div>

                                <div class="tools">

                                    <a href="javascript:;" class="reload"></a>

                                    <a href="javascript:;" class="remove"></a>

                                </div>

                            </div>
                            <div class="portlet-body" >
                                <div class="alert alert-block alert-success fade in" id="running">

                                    <h4 class="alert-heading">进程正在运行!</h4>

                                    <p>
                                        爬虫正努力地在网上溜达！
                                    </p>
                                    <br>

                                    <p>
                                        <a class="btn red" onclick="Dajaxice.spider.server_manager(serverMessage, {'commd': 'stop'})">关闭进程</a>
                                    </p>

                                </div>

                                <div class="alert alert-block alert-warning fade in" id="waiting">

                                    <h4 class="alert-heading">进程等待中!</h4>

                                    <p>
                                        爬虫正在休息中……它将在以下时间后再次出门！
                                    </p>
                                    <br>
                                    <p>
                                        <a class="btn green" onclick="Dajaxice.spider.server_manager(serverMessage, {'commd': 'stop'})">关闭进程</a>
                                    </p>
                                </div>
                                <div class="coming-soon-countdown" style="background-color: #0088CC" id="time">
                                    <div id="defaultCountdown"></div>
                                </div>
                                <div class="alert alert-block alert-error fade in" id="stopped">

                                    <h4 class="alert-heading">进程已经停止工作!</h4>

                                    <p>
                                        哎呀！爬虫死了……_(:зゝ∠)_
                                    </p>
                                    <br>

                                    <p>
                                        <a class="btn green" onclick="Dajaxice.spider.server_manager(serverMessage, {'commd': 'start'})">启动进程</a>
                                    </p>

                                </div>
                            </div>

                        </div>
                    {% else %}
                        <div class="portlet box blue">

                            <div class="portlet-title">

                                <div class="caption"><i class="icon-reorder"></i>后台认证</div>

                                <div class="tools">

                                    <a href="javascript:;" class="remove"></a>

                                </div>

                            </div>

                            <div class="portlet-body form">

                                <h3 class="block">输入密码以认证身份</h3>

                                <!-- BEGIN FORM-->

                                <form action="/manage/" class="form-horizontal" method="post">

                                    <div class="control-group">

                                        <label class="control-label">密码<span class="required">*</span></label>

                                        <div class="controls">

                                            <input type="password" class="span6 m-wrap" name="password"
                                                   id="submit_form_password"/>

                                        </div>

                                    </div>

                                    <div class="form-actions">

                                        <button type="submit" class="btn blue">确认</button>

                                    </div>

                                </form>

                                <!-- END FORM-->

                            </div>
                        </div>
                    {% endif %}


                    <!-- END PORTLET-->

                </div>

            </div>

        </div>

        <!-- END PAGE CONTAINER-->

    </div>

    <!-- END PAGE -->

</div>

<!-- END CONTAINER -->

<!-- BEGIN FOOTER -->

<div class="footer">

    <div class="footer-inner">

        2013 &copy; Metronic by keenthemes.Collect

    </div>

    <div class="footer-tools">

			<span class="go-top">

			<i class="icon-angle-up"></i>

			</span>

    </div>

</div>

<!-- END FOOTER -->

<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->

<!-- BEGIN CORE PLUGINS -->

<script src="/media/js/jquery-1.10.1.min.js" type="text/javascript"></script>

<script src="/media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>

<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->

<script src="/media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>

<script src="/media/js/bootstrap.min.js" type="text/javascript"></script>

<!--[if lt IE 9]>

	<script src="media/js/excanvas.min.js"></script>

	<script src="media/js/respond.min.js"></script>

	<![endif]-->

<script src="/media/js/jquery.slimscroll.min.js" type="text/javascript"></script>

<script src="/media/js/jquery.blockui.min.js" type="text/javascript"></script>

<script src="/media/js/jquery.cookie.min.js" type="text/javascript"></script>

<script src="/media/js/jquery.uniform.min.js" type="text/javascript"></script>

<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE LEVEL SCRIPTS -->

<script type="text/javascript" src="/media/js/jquery.gritter.js"></script>

<script type="text/javascript" src="/media/js/jquery.pulsate.min.js"></script>

<script type="text/javascript" src="/media/js/jquery.bootpag.min.js"></script>

<script src="/media/js/jquery.countdown.js" type="text/javascript"></script>

<script src="/media/js/jquery.backstretch.min.js" type="text/javascript"></script>

<script src="/media/js/app.js" type="text/javascript"></script>

<script src="/media/js/index.js" type="text/javascript"></script>

<script src="/media/js/highcharts.js"></script>

<script src="/media/js/modules/exporting.js"></script>

<script src="/media/js/coming-soon.js" type="text/javascript"></script>

<!-- END PAGE LEVEL SCRIPTS -->

<script>

    var CoomingSoon = function () {

        return {
            //main function to initiate the module
            init: function (year, month, day, hour, min, sec) {

                $.backstretch([
                    "assets/img/bg/1.jpg",
                    "assets/img/bg/2.jpg",
                    "assets/img/bg/3.jpg",
                    "assets/img/bg/4.jpg"
                    ], {
                      fade: 1000,
                      duration: 10000
                });

                var austDay = new Date();
                austDay.setFullYear(year, month-1, day);
                austDay.setHours(hour, min, sec);
{#                console.log(austDay);#}
{#                austDay = new Date(austDay.getFullYear(), austDay.getMonth(), austDay.getDate()+1);#}
                $('#defaultCountdown').countdown({until: austDay});
                $('#year').text(austDay.getFullYear());
            }

        };

    }();

    jQuery(document).ready(function () {

        App.init(); // initlayout and core plugins

        Index.init();

{#        CoomingSoon.init();#}

        Dajaxice.spider.get_next_time(setNextTime);

        Dajaxice.spider.server_manager(serverMessage, {'commd': 'get'});

        setInterval(getMessage, 3000);

    });

</script>

<script>
    function setNextTime(data){
{#        console.log(data);#}
        CoomingSoon.init(
                data.result[0],
                data.result[1],
                data.result[2],
                data.result[3],
                data.result[4],
                data.result[5]
        );
    }

    function getMessage(){
        console.log('getmessage');
        Dajaxice.spider.server_manager(serverMessage, {'commd': 'get'});
    }

    function serverMessage(data){
        flag = [
                '#running',
                '#stopped',
                '#waiting',
                '#time'
        ];
        console.log(data.result);
        switch (data.result) {
            case 'R':
                    $(flag[0]).removeClass('hidden');
                    $(flag[1]).addClass('hidden');
                    $(flag[2]).addClass('hidden');
                    $(flag[3]).addClass('hidden');
                    break;
            case 'S':
                    console.log(data);
                    $(flag[1]).removeClass('hidden');
                    $(flag[0]).addClass('hidden');
                    $(flag[2]).addClass('hidden');
                    $(flag[3]).addClass('hidden');
                    break;
            case 'W':
                    $(flag[2]).removeClass('hidden');
                    $(flag[3]).removeClass('hidden');
                    $(flag[1]).addClass('hidden');
                    $(flag[0]).addClass('hidden');
                    break;
            default :  break;
        }
    }
</script>



<!-- END JAVASCRIPTS -->

</body>

<!-- END BODY -->

</html>